/**
 * Date instance methods
 *
 * @author Ken Snyder (kendsnyder at gmail dot com)
 * @date December 2011
 * @version 3.3 (http://sandbox.kendsnyder.com/date)
 * @license Creative Commons Attribution License 3.0 (http://creativecommons.org/licenses/by/3.0)
 */
;(function(h){var j=24*60*60*1000;function zeroPad(a,b){a=a+'';var c=b-a.length;if(c<=0){return a}return Array(c+1).join('0')+a}function extend(d,s){for(var p in s){if(Object.prototype.hasOwnProperty.call(s,p)){d[p]=s[p]}}}var k={millisecond:1,second:1000,minute:60*1000,hour:60*60*1000,day:j,week:7*j,month:{add:function(d,a){var b=d.getDate();k.year.add(d,Math[a>0?'floor':'ceil'](a/12));var c=d.getMonth()+(a%12);if(c==12){c=0;d.setYear(d.getFullYear()+1)}else if(c==-1){c=11;d.setYear(d.getFullYear()-1)}d.setMonth(c);if(d.getDate()!=b){d.add(-1,'month');d.setDate(d.daysInMonth())}},diff:function(a,b){var c=a.getFullYear()-b.getFullYear();var d=a.getMonth()-b.getMonth()+(c*12);var e=a.getDate()-b.getDate();return d+(e/30)}},year:{add:function(d,a){d.setYear(d.getFullYear()+Math[a>0?'floor':'ceil'](a))},diff:function(a,b){return k.month.diff(a,b)/12}}};var m=k;m.milliseconds=m.millisecond;m.seconds=m.second;m.minutes=m.minute;m.hours=m.hour;m.weeks=m.week;m.days=m.day;m.months=m.month;m.years=m.year;var l={succ:function(a){return this.clone().add(1,a)},add:function(a,b){var c=k[b]||k.day;if(typeof c=='number'){this.setTime(this.getTime()+(c*a))}else{c.add(this,a)}return this},diff:function(a,b,c){var d;a=Date.create(a);if(a===null){return NaN}var e=k[b]||k.day;if(typeof e=='number'){d=(this.getTime()-a.getTime())/e}else{d=e.diff(this,a)}return(c?d:Math[d>0?'floor':'ceil'](d))},_applyFormat:function(a,b){var c=a||b.defaultFormat,result='',match;while(c.length>0){if((match=c.match(b.matcher))){result+=c.slice(0,match.index);result+=(match[1]||'')+this._applyFormatChar(match[2],b);c=c.slice(match.index+match[0].length)}else{result+=c,c=''}}return result},_applyFormatChar:function(a,b){if(b.shortcuts&&b.shortcuts[a]){return this._applyFormat(b.shortcuts[a],b)}else if(b.codes&&b.codes[a]){var c=b.codes[a].split('.');var d=this['get'+c[0]]?this['get'+c[0]]():'';if(c[1]){d=zeroPad(d,c[1])}return d}return a},format:function(a){a=a||Date.formatting.strftime.defaultFormat;if(a.indexOf('%')>-1){return this.strftime(a)}return this.formatPhp(a)},getShortYear:function(){return this.getYear()%100},getMonthNumber:function(){return this.getMonth()+1},getMonthName:function(){return Date.MONTHNAMES[this.getMonth()]},getAbbrMonthName:function(){return Date.ABBR_MONTHNAMES[this.getMonth()]},getDayName:function(){return Date.DAYNAMES[this.getDay()]},getAbbrDayName:function(){return Date.ABBR_DAYNAMES[this.getDay()]},getDayOrdinal:function(){return Date.ORDINALNAMES[this.getDate()%10]},getHours12:function(){var a=this.getHours();return a>12?a-12:(a==0?12:a)},getAmPm:function(){return this.getHours()>=12?'PM':'AM'},getAmPmLower:function(){return this.getHours()>=12?'pm':'am'},getUnix:function(){return Math.round(this.getTime()/1000,0)},getUTCOffset:function(){var a=this.getTimezoneOffset()/60;var b=a<0?'+':'-';a=Math.abs(a);return b+zeroPad(Math.floor(a),2)+':'+zeroPad((a%1)*60,2)},setUTCOffset:function(a){var b=this.getTimezoneOffset();var c=this.getTime()+(b*60000);this.setTime(c-(a*60000));return this},setUTCOffsetString:function(a){var b=a.match(/([+-]?)([01]\d|2[0-3])\:?([0-5]\d)/);if(b){var c=parseFloat(b[2])*60;c+=parseFloat(b[3]);if(b[1]=='-'){c*=-1}this.setUTCOffset(c)}return this},getUTCOffsetNumber:function(){return this.getUTCOffset().replace(':','')},getTimezoneName:function(){var a=/(?:\((.+)\)$| ([A-Z]{3}) )/.exec(this.toString());return a[1]||a[2]||'GMT'+this.getUTCOffset()},toYmdInt:function(){return(this.getFullYear()*10000)+(this.getMonthNumber()*100)+this.getDate()},clone:function(){return new Date(this.getTime())},diffText:function(a){var b=this.diff(a||Date.current(),'seconds');var c=Math.abs(b);var d;if(c<120){return b>=0?'in a moment':'moments ago'}else if(c<3600){d=floor(c/60)+" minutes"}else if(c<86400){var e=floor(c/3600);var s=hour==1?'':'s';d=e+" hour"+s+" ago"}else if(c<172800){return b>0?'tomorrow':'yesterday'}else if(c<604800){d=floor(c/86400)+" days"}else if(c<1209600){return b>0?'next week':'last week'}else if(c<2419200){d=floor(c/604800)+" weeks"}else if(c<5184000){return b>0?'next month':'last month'}else if(c<31536000){d=floor(c/2592000)+" months"}else if(c<63072000){return b>0?'next year':'last year'}else{d=floor(c/31536000)+" years"}return(b>0?'in '+d:d+' ago')},daysInMonth:function(){return Date.daysInMonth(this.getFullYear(),this.getMonth()+1)},isLeapYear:function(){return Date.daysInMonth(this.getFullYear(),1)==29?1:0}};extend(Date.prototype,l);if(!Date.prototype.toISOString){Date.prototype.toISOString=function(){return this.setUTCOffset(0).strftime(Date.ISO)}}var n={create:function(b){if(typeof b=='undefined'){return Date.current()}if(b instanceof Date){return b}var a=arguments;switch(a.length){case 1:if(Object.prototype.toString.call(b)=='[object Number]'){return new Date(b)}b=String(b).replace(/^\s*(.*)\s*$/,'$1');if(b===''){return Date.current()}var i=0,pattern,ms,obj,match,regex,fn;while((pattern=Date.create.patterns[i++])){if(typeof pattern[0]=='string'){regex=pattern[1];fn=pattern[2]}else{regex=pattern[0];fn=pattern[1]}if(!(match=b.match(regex))){continue}if(typeof fn=='function'){obj=fn(match,b);if(obj instanceof Date){return obj}}else{ms=Date.parse(b.replace(regex,fn));if(!isNaN(ms)){return new Date(ms)}}}return NaN;case 2:return new Date(a[0],a[1],1);case 3:return new Date(a[0],a[1],a[2]);case 4:return new Date(a[0],a[1],a[2],a[3]);case 5:return new Date(a[0],a[1],a[2],a[3],a[4]);case 6:return new Date(a[0],a[1],a[2],a[3],a[4],a[5]);default:return new Date(a[0],a[1],a[2],a[3],a[4],a[5],a[6])}},MONTHNAMES:'January February March April May June July August September October November December'.split(' '),ABBR_MONTHNAMES:'Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec'.split(' '),DAYNAMES:'Sunday Monday Tuesday Wednesday Thursday Friday Saturday'.split(' '),ABBR_DAYNAMES:'Sun Mon Tue Wed Thu Fri Sat'.split(' '),ORDINALNAMES:'th st nd rd th th th th th th'.split(' '),ISO:'%Y-%m-%dT%H:%M:%S.%N%G',SQL:'%Y-%m-%d %H:%M:%S',SCRIPT_LOAD:new Date,daysInMonth:function(a,b){if(b==2){return new Date(a,1,29).getDate()==29?29:28}return[undefined,31,undefined,31,30,31,30,31,31,30,31,30,31][b]},autoFormat:function(b,c){b=(typeof b=='string'?document.getElementById(b):b);function correct(){var a=Date.create(b.value);if(a){b.value=a.format(c)}}if(typeof b.attachEvent=='function'){b.attachEvent('onblur',correct)}else if(typeof b.addEventListener=='function'){b.addEventListener('blur',correct,false)}else{b.onblur=correct}return b},addFormat:function(b,c){Date.prototype[b]=function(a){return this._applyFormat(a,c)};return this},addPattern:function(a,b){if(b){var i=0,pattern;while((pattern=Date.create.patterns[i++])){if(pattern[0]==b||pattern[1]==b){Date.create.patterns.splice(i,0,a);return this}}}Date.create.patterns.unshift(a);return this},removePattern:function(a){var i=0,pattern;while((pattern=Date.create.patterns[i++])){if(pattern[0]==a||pattern[1]==a){return Date.create.patterns.splice(i-1,1)[0]}}return false},current:function(){return new Date}};extend(Date,n);if(!('now'in Date)){Date.now=function(){return Date.current().setUTCOffset(0).getTime()}}Date.addFormat('strftime',{matcher:/()%(#?(%|[a-z]))/i,defaultFormat:'%Y-%m-%d %H:%M:%s',codes:{Y:'FullYear',y:'ShortYear.2',m:'MonthNumber.2','#m':'MonthNumber',B:'MonthName',b:'AbbrMonthName',d:'Date.2','#d':'Date',e:'Date',A:'DayName',a:'AbbrDayName',w:'Day',o:'DayOrdinal',H:'Hours.2','#H':'Hours',I:'Hours12.2','#I':'Hours12',P:'AmPmLower',p:'AmPm',M:'Minutes.2','#M':'Minutes',S:'Seconds.2','#S':'Seconds',s:'Unix',N:'Milliseconds.3','#N':'Milliseconds',O:'TimezoneOffset',Z:'TimezoneName',G:'UTCOffset'},shortcuts:{F:'%Y-%m-%d',T:'%H:%M:%S',X:'%H:%M:%S',x:'%m/%d/%y',D:'%m/%d/%y','#c':'%a %b %e %H:%M:%S %Y',v:'%e-%b-%Y',R:'%H:%M',r:'%I:%M:%S %p',t:'\t',n:'\n','%':'%'}});Date.addFormat('formatPhp',{matcher:/(\\)?([a-z])/i,defaultFormat:'Y-m-d H:i:s',codes:{Y:'FullYear',y:'ShortYear.2',L:'isLeapYear',m:'MonthNumber.2',n:'MonthNumber',F:'MonthName',M:'AbbrMonthName',t:'daysInMonth',d:'Date.2',j:'Date',l:'DayName',D:'AbbrDayName',w:'Day',S:'DayOrdinal',H:'Hours.2',G:'Hours',h:'Hours12.2',g:'Hours12',a:'AmPmLower',A:'AmPm',i:'Minutes.2',s:'Seconds.2',U:'Unix',Z:'TimezoneOffset',e:'TimezoneName',P:'UTCOffset',O:'UTCOffsetNumber'},shortcuts:{c:'Y-m-d\\TH:i:sP',r:'D, j M Y H:i:s O'}});var o={matcher:/()(mi|am|pm|ss|yyyy|yy|m{1,4}|d{1,4}|w|hh?24|hh?12)/i,defaultFormat:'yyyy-mm-dd hh24:mi:ss',codes:{yyyy:'FullYear',yy:'ShortYear.2',mm:'MonthNumber.2',m:'MonthNumber',mmm:'AbbrMonthName',mmmm:'MonthName',dd:'Date.2',d:'Date',ddd:'AbbrDayName',dddd:'DayName',w:'Day',hh24:'Hours.2',h24:'Hours',hh:'Hours12.2',hh12:'Hours12.2',h12:'Hours12',am:'AmPm',pm:'AmPm',mi:'Minutes.2',ss:'Seconds.2'},shortcuts:{}};var q='yyyy yy mm m mmm mmmm dd d ddd dddd w hh24 h24 hh12 h12 am pm mi ss'.split(' '),i=0,key;while((key=q[i++])){o.codes[key.toUpperCase()]=o.codes[key]}Date.addFormat('formatSql',o);Date.create.patterns=[['iso_8601',/^([1-9]\d{3})\s*-\s*(1[0-2]|0?[1-9])\s*-\s*(3[01]|[12]\d|0?[1-9])$/,'$2/$3/$1'],['us',/^(1[0-2]|0?[1-9])\s*[\/-]\s*(3[01]|[12]\d|0?[1-9])\s*[\/-]\s*([1-9]\d{3})$/,'$1/$2/$3'],['world',/^(3[01]|[12]\d|0?[1-9])\s*([\.\/])s*(1[0-2]|0?[1-9])\s*\2\s*([1-9]\d{3})$/,'$3/$1/$4'],['chicago',/^(?:(?:mon|tue|wed|thu|fri|sat|sun),\s+)?(3[01]|[0-2]\d|\d)\s*([ -])\s*(?:(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)[a-z]*)\s*\2\s*([1-9]\d{3})$/i,'$3 $1, $4'],['conversational',/^(?:(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)[a-z]*)\s+(3[01]|[0-2]\d|\d),?\s*([1-9]\d{3})$/i,'$1 $2, $3'],['unix',/^@(-?\d+)$/,function(a){return Date.create(a[1]*1000)}],['24_hour',/^(?:(.+?)(?:\s+|T))?([01]\d|2[0-3])(?:\s*\:\s*([0-5]\d))(?:\s*\:\s*([0-5]\d))?\s*(?:\.(\d+))?(\s*[+-](?:[01]\d|2[0-3])\:?[0-5]\d)?$/i,function(a){var d;if(a[1]){d=Date.create(a[1]);if(isNaN(d)){return false}}else{d=Date.current();d.setMilliseconds(0)}d.setHours(parseFloat(a[2]),parseFloat(a[3]),parseFloat(a[4]||0));if(a[5]){d.setMilliseconds(a[5])}if(a[6]){d.setUTCOffsetString(a[6])}return d}],['12_hour',/^(?:(.+)\s+)?(0?[1-9]|1[012])(?:\s*\:\s*([0-5]\d))?(?:\s*\:\s*([0-5]\d))?\s*(am|pm)\s*$/i,function(a){var d;if(a[1]){d=Date.create(a[1]);if(isNaN(d)){return false}}else{d=Date.current();d.setMilliseconds(0)}var b=parseFloat(a[2]);b=a[5].toLowerCase()=='am'?(b==12?0:b):(b==12?12:b+12);d.setHours(b,parseFloat(a[3]||0),parseFloat(a[4]||0));return d}],['weeks_months_before_after',/^(\d+)\s+(year|month|week|day|hour|minute|second)s?\s+(before|from|after)\s+(.+)$/i,function(a){var b=Date.create(a[4]);if(b instanceof Date){return b.add((a[3].toLowerCase()=='before'?-1:1)*a[1],a[2])}return false}],['time_ago',/^(\d+)\s+(year|month|week|day|hour|minute|second)s?\s+ago$/i,function(a){return Date.current().add(-1*a[1],a[2])}],['in_time',/^in\s+(\d+)\s+(year|month|week|day|hour|minute|second)s?$/i,function(a){return Date.current().add(a[1],a[2])}],['today_tomorrow',/^(tod|now|tom|yes)/i,function(a){var b=Date.current();switch(a[1].toLowerCase()){case'tod':case'now':return b;case'tom':return b.add(1,'day');case'yes':return b.add(-1,'day')}}],['this_next_last',/^(this|next|last)\s+(?:(year|month|week|day|hour|minute|second)|(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)|(sun|mon|tue|wed|thu|fri|sat))/i,function(a){var b=a[1].toLowerCase()=='last'?-1:1;var c=Date.current();var d=Date.ABBR_MONTHNAMES;var i;if(a[2]){return c.add(b,a[2])}else if(a[3]){var e=a[3].toLowerCase(),diff;for(i=0;i<d.length;i++){if(e==d[i].toLowerCase()){diff=12-(c.getMonth()-i);diff=diff>12?diff-12:diff;return c.add(b*diff,'month')}}}else if(a[4]){var f=a[4].toLowerCase();var g=Date.ABBR_DAYNAMES;for(i=0;i<g.length;i++){if(f==g[i].toLowerCase()){diff=c.getDay()-i+7;return c.add(b*(diff==0?7:diff),'day')}}}return false}],['conversational_sans_year',/^(?:(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)[a-z]*\s+)(?:the\s+)?(\d+)(?:st|nd|rd|th)?$/i,function(a){var d=Date.current();if(a[1]){var i=Date.ABBR_MONTHNAMES.length;while(i--){if(Date.ABBR_MONTHNAMES[i].toLowerCase()==a[1].toLowerCase()){d.setMonth(i);break}}}d.setDate(a[2]);return d}]];h.$D=h.$D||Date.create})(this);